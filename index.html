<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>iOS Style Calculator</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
    body{
        margin:0;
        background:#000;
        display:flex;
        justify-content:center;
        align-items:center;
        height:100vh;
        overflow:hidden;
        touch-action:manipulation;
        font-family:-apple-system, BlinkMacSystemFont, "Helvetica Neue";
    }

    .calculator{
        width: min(95vw, 500px);
        height: min(90vh, 800px);
        display:flex;
        flex-direction:column;
        justify-content:space-between;
    }

    .display{
        color:white;
        text-align:right;
        padding:20px;
        font-size:3rem;
        height:120px;
        overflow:hidden;
        white-space:nowrap;
    }

    .formula{
        color:#888;
        font-size:1.2rem;
        margin-bottom:10px;
    }

    .buttons{
        display:grid;
        gap:10px;
        width:100%;
        height:100%;
    }

    /* è‡ªå‹•ä¾ç…§è¢å¹•é‡æ–°æ’åˆ— */
    @media (orientation:portrait){
        .buttons{
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
        }
    }

    @media (orientation:landscape){
        .calculator{
            width: min(90vw, 650px);
            height: min(95vh, 450px);
        }
        .buttons{
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(4, 1fr);
        }
    }

    button{
        border:none;
        border-radius:18px;
        font-size:2rem;
        color:white;
        background:#333;
        transition:transform 0.05s;
        touch-action:manipulation;
    }

    button:active{
        transform:scale(0.92);
    }

    .orange{ background:#ff9f0a; }
    .gray{ background:#a5a5a5; color:black; }
</style>
</head>

<body>

<div class="calculator">
    <div class="display">
        <div class="formula" id="formula"></div>
        <div id="result">0</div>
    </div>

    <div class="buttons">
        <button class="gray">AC</button>
        <button class="gray">+/-</button>
        <button class="gray">%</button>
        <button class="orange">Ã·</button>

        <button>7</button>
        <button>8</button>
        <button>9</button>
        <button class="orange">Ã—</button>

        <button>4</button>
        <button>5</button>
        <button>6</button>
        <button class="orange">âˆ’</button>

        <button>1</button>
        <button>2</button>
        <button>3</button>
        <button class="orange">+</button>

        <button style="grid-column: span 2;">0</button>
        <button>.</button>
        <button class="orange">=</button>
    </div>
</div>

<script>
const result = document.getElementById("result");
const formula = document.getElementById("formula");

let current = "0";
let expr = "";

document.querySelectorAll("button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
        const v = btn.innerText;
        speak(v); // ğŸŸ¢ é»æŒ‰æ™‚èªªå‡ºæ•¸å­—

        if(!isNaN(v)){ // number
            current = current==="0" ? v : current+v;
        }else if(["+","âˆ’","Ã—","Ã·"].includes(v)){
            expr += current + " " + v + " ";
            current = "0";
        }else if(v==="AC"){
            current="0"; expr="";
        }else if(v==="."){
            if(!current.includes(".")) current += ".";
        }else if(v==="+/-"){
            current = (parseFloat(current)*(-1)).toString();
        }else if(v==="%"){
            current = (parseFloat(current)/100).toString();
        }else if(v==="="){
            expr += current;
            formula.innerText = expr;
            current = eval(expr.replace(/Ã—/g,"*").replace(/Ã·/g,"/").replace(/âˆ’/g,"-")).toString();
            expr = "";
        }

        result.innerText = current;
        if(expr==="") formula.innerText = "";
    });
});


// ğŸ”Š èªéŸ³åŠŸèƒ½ï¼ˆæ”¯æ´ iPhone / iPadï¼‰
function speak(text){
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = "en-US";
    speechSynthesis.speak(msg);
}
</script>

<script>
// PWA å®‰è£
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>