<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>iOS Style Calculator</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
    body{
        margin:0;
        background:#000;
        display:flex;
        justify-content:center;
        align-items:center;
        height:100vh;
        overflow:hidden;
        touch-action:manipulation;
        font-family:-apple-system, BlinkMacSystemFont, "Helvetica Neue";
    }

    .calculator{
        width: min(95vw, 500px);
        height: min(90vh, 800px);
        display:flex;
        flex-direction:column;
        justify-content:space-between;
    }

    .display{
        color:white;
        text-align:right;
        padding:20px;
        font-size:3rem;
        height:120px;
        overflow:hidden;
        white-space:pre-wrap;
    }

    .formula{
        color:#888;
        font-size:1.2rem;
        margin-bottom:10px;
        white-space:pre-wrap;
    }

    .buttons{
        display:grid;
        gap:10px;
        width:100%;
        height:100%;
    }

    /* 直立模式（iPhone / iPad 直放） */
    @media (orientation:portrait){
        .buttons{
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
        }
    }

    /* 橫放模式（iPad） */
    @media (orientation:landscape){
        .calculator{
            width: min(90vw, 650px);
            height: min(95vh, 450px);
        }
        .buttons{
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(4, 1fr);
        }
    }

    button{
        border:none;
        border-radius:18px;
        font-size:2rem;
        color:white;
        background:#333;
        transition:transform 0.05s;
        touch-action:manipulation;
    }

    /* iOS 按壓動畫 */
    button:active{
        transform:scale(0.92);
    }

    .orange{ background:#ff9f0a; }
    .gray{ background:#a5a5a5; color:black; }
</style>
</head>

<body>

<div class="calculator">
    <div class="display">
        <div class="formula" id="formula"></div>
        <div id="result">0</div>
    </div>

    <div class="buttons">
        <button class="gray">AC</button>
        <button class="gray">+/-</button>
        <button class="gray">%</button>
        <button class="orange">÷</button>

        <button>7</button>
        <button>8</button>
        <button>9</button>
        <button class="orange">×</button>

        <button>4</button>
        <button>5</button>
        <button>6</button>
        <button class="orange">−</button>

        <button>1</button>
        <button>2</button>
        <button>3</button>
        <button class="orange">+</button>

        <button style="grid-column: span 2;">0</button>
        <button>.</button>
        <button class="orange">=</button>
    </div>
</div>

<script>
const result = document.getElementById("result");
const formula = document.getElementById("formula");

let current = "0";
let expr = "";
let history = []; // 用來儲存最近的算式紀錄（最多 2 筆）

document.querySelectorAll("button").forEach(btn=>{
    btn.addEventListener("click", ()=>{
        const v = btn.innerText;

        speak(v); // 中文語音

        if(!isNaN(v)){ // number
            current = current==="0" ? v : current+v;
        }else if(["+","−","×","÷"].includes(v)){
            expr += current + " " + v + " ";
            current = "0";
        }else if(v==="AC"){
            current="0"; expr="";
            history = [];
        }else if(v==="."){
            if(!current.includes(".")) current += ".";
        }else if(v==="+/-"){
            current = (parseFloat(current)*(-1)).toString();
        }else if(v==="%"){
            current = (parseFloat(current)/100).toString();
        }else if(v==="="){
            expr += current;
            
            // 計算結果
            try{
                current = eval(expr.replace(/×/g,"*").replace(/÷/g,"/").replace(/−/g,"-")).toString();
            }catch(e){
                current = "Error";
            }

            // 加入 history，最多保留 2 筆
            history.push(expr + " = " + current);
            if(history.length > 2) history.shift();

            // 顯示歷史算式
            formula.innerText = history.join("\n");

            expr = "";
        }

        result.innerText = current;

        // 顯示未完成的運算式
        if(v !== "=" && expr !== "") formula.innerText = history.concat(expr).join("\n");
    });
});

// 中文語音（台灣國語）
function speak(text){
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = "zh-TW";
    msg.rate = 1;
    msg.pitch = 1;
    msg.volume = 1;
    speechSynthesis.cancel(); // 避免堆疊
    speechSynthesis.speak(msg);
}

// PWA 安裝
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>