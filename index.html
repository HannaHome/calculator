<!DOCTYPE html>
<html lang="en">
<head>
    <!-- PWA 基本 -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">

<!-- iOS / iPadOS 專用 -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Calculator">

<!-- 防止 iPad 出現網址列、支援舊版 iPad -->
<meta name="viewport"
      content="width=device-width, initial-scale=1.0,
      maximum-scale=1.0, user-scalable=no,
      viewport-fit=cover, minimal-ui">

<!-- iOS 啟動畫面（自動裁）-->
<link rel="apple-touch-icon" href="icons/icon-180.png">
<link rel="apple-touch-startup-image" href="icons/splash-2048x2732.png">
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>iOS Style Calculator</title>

<style>
    body {
        background: black;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
        margin: 0;
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
    }

    /* 顯示區：上面算式、下面結果 */
    #display-wrapper {
        padding: 30px 24px 10px;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: flex-end;
    }

    #formula {
        font-size: 1.4rem;
        opacity: 0.6;
        min-height: 1.6rem;
    }

    #display {
        font-size: 4.8rem;
        line-height: 1.1;
        margin-top: 6px;
    }

    /* 按鈕區 */
    #buttons {
        padding: 0 10px 30px;
        display: grid;
        gap: var(--gap);
        grid-template-columns: repeat(4, 1fr);
    }

    .btn {
        border-radius: 50%;
        border: none;
        font-size: var(--font);
        height: var(--size);
        width: var(--size);
        display: flex;
        align-items: center;
        justify-content: center;
        background: #333;
        color: white;
        transition: transform 0.08s;
        -webkit-tap-highlight-color: transparent;
        user-select: none;
    }

    .btn:active {
        transform: scale(0.92);
    }

    .op {
        background: #ff9f0a;
    }

    .func {
        background: #a5a5a5;
        color: black;
    }

    /* ==== 尺寸重新加大 ==== */
    :root {
        --size: 82px;   /* iPhone 放大版 */
        --gap: 14px;
        --font: 2.4rem;
    }

    @media (min-width: 400px) {
        :root {
            --size: 94px; /* iPhone Plus 放大 */
            --gap: 16px;
            --font: 2.6rem;
        }
    }

    @media (min-width: 700px) {
        :root {
            --size: 130px; /* iPad 放大 */
            --gap: 22px;
            --font: 3.4rem;
        }
    }
</style>
</head>

<body>
<script>
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js");
}
</script>
<div id="display-wrapper">
    <div id="formula"></div>
    <div id="display">0</div>
</div>

<div id="buttons">
    <button class="btn func" data-key="del">⌫</button>
    <button class="btn func" data-key="ac">AC</button>
    <button class="btn func" data-key="%">%</button>
    <button class="btn op"   data-key="÷">÷</button>

    <button class="btn" data-key="7">7</button>
    <button class="btn" data-key="8">8</button>
    <button class="btn" data-key="9">9</button>
    <button class="btn op" data-key="×">×</button>

    <button class="btn" data-key="4">4</button>
    <button class="btn" data-key="5">5</button>
    <button class="btn" data-key="6">6</button>
    <button class="btn op" data-key="−">−</button>

    <button class="btn" data-key="1">1</button>
    <button class="btn" data-key="2">2</button>
    <button class="btn" data-key="3">3</button>
    <button class="btn op" data-key="+">+</button>

    <button class="btn func" data-key="+/-">+/-</button>
    <button class="btn" data-key="0">0</button>
    <button class="btn" data-key=".">.</button>
    <button class="btn op" data-key="=">=</button>
</div>

<script>
const display = document.getElementById("display");
const formula = document.getElementById("formula");

let buffer = "0";
let operator = null;
let previous = null;
let chainFormula = ""; // 用來保留算式

function updateDisplay() {
    display.textContent = buffer;
    formula.textContent = chainFormula;
}

document.querySelectorAll(".btn").forEach(btn => {
    btn.addEventListener("click", () => {
        const key = btn.dataset.key;

        if (!isNaN(key)) {
            buffer = buffer === "0" ? key : buffer + key;
        } 
        else if (key === ".") {
            if (!buffer.includes(".")) buffer += ".";
        }
        else if (key === "ac") {
            buffer = "0";
            operator = null;
            previous = null;
            chainFormula = "";
        }
        else if (key === "del") {
            buffer = buffer.length > 1 ? buffer.slice(0, -1) : "0";
        }
        else if (["+", "−", "×", "÷"].includes(key)) {
            operator = key;
            previous = buffer;
            chainFormula += `${buffer} ${key} `;
            buffer = "0";
        }
        else if (key === "=") {
            if (operator && previous !== null) {
                const a = parseFloat(previous);
                const b = parseFloat(buffer);
                let result = a;

                switch (operator) {
                    case "+": result = a + b; break;
                    case "−": result = a - b; break;
                    case "×": result = a * b; break;
                    case "÷": result = b === 0 ? "Error" : a / b; break;
                }

                chainFormula += buffer + " =";
                buffer = result.toString();
                operator = null;
                previous = null;
            }
        }
        else if (key === "%") {
            buffer = (parseFloat(buffer) / 100).toString();
        }
        else if (key === "+/-") {
            buffer = (parseFloat(buffer) * -1).toString();
        }

        updateDisplay();
    });
});
</script>

</body>
</html>