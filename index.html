<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>iOS 計算機</title>

<style>
  :root{
    --bg1:#f7f8fb;
    --bg2:#eef2ff;
    --accent: linear-gradient(135deg,#7c5cff,#4dd2ff);
    --radius:20px;
    --font-main:-apple-system,"SF Pro Text","Helvetica Neue","Segoe UI",Roboto,Arial,sans-serif;
  }
  *{box-sizing:border-box;font-family:var(--font-main);}

  /* 禁止雙擊放大 */
  body{
    margin:0;
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
    display:flex;justify-content:center;align-items:center;
    height:100vh;padding:20px;
    touch-action: manipulation;
  }

  .app{
    width:380px;max-width:95vw;
    padding:20px;border-radius:30px;
    background:rgba(255,255,255,0.45);
    backdrop-filter:blur(18px) saturate(140%);
    box-shadow:0 8px 25px rgba(0,0,0,0.12);
  }

  /* ============================================
     三種自動尺寸
     ============================================ */
  body.size-small { --btn-size:56px; --btn-font:20px; --gap:10px; --panel-pad:14px; }
  body.size-medium{ --btn-size:66px; --btn-font:23px; --gap:12px; --panel-pad:16px; }
  body.size-large { --btn-size:78px; --btn-font:28px; --gap:14px; --panel-pad:22px; }

  /* 顯示區 */
  .display{
    padding:var(--panel-pad);
    background:rgba(255,255,255,0.7);
    border-radius:18px;
    box-shadow:0 6px 18px rgba(30,34,40,0.08);
    margin-bottom:20px;
  }
  .expression{
    font-size:16px;color:#7f86a6;min-height:22px;
  }
  .result{
    font-size:42px;font-weight:700;text-align:right;margin-top:6px;
  }

  /* 按鍵 */
  .pad{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:var(--gap);
  }

  .btn{
    width:100%;height:var(--btn-size);
    border-radius:18px;
    border:0;
    background:linear-gradient(180deg,#fff,#f4f5ff);
    box-shadow:0 4px 14px rgba(0,0,0,0.06);
    font-size:var(--btn-font);
    display:flex;justify-content:center;align-items:center;
    user-select:none;cursor:pointer;font-weight:600;
    transition:transform .05s ease;
    touch-action: manipulation;
  }

  .btn:active{
    transform:scale(0.92);
  }

  .btn--operator{
    background:linear-gradient(180deg,#f5f1ff,#ece6ff);
    color:#4c3bb2;
  }

  .btn--accent{
    background:var(--accent);
    color:#fff;
    box-shadow:0 6px 18px rgba(100,70,255,0.22);
  }

  .btn--wide{grid-column:span 2;}
  .btn--ghost{
    background:transparent;
    border:1px solid rgba(0,0,0,0.08);
    color:#7e8499;
  }
</style>
</head>

<body>
<div class="app">

  <div class="display">
    <div id="expression" class="expression">0</div>
    <div id="result" class="result">0</div>
  </div>

  <div class="pad" id="pad">
    <button class="btn btn--ghost" data-action="ac">AC</button>
    <button class="btn btn--ghost" data-action="back">⌫</button>
    <button class="btn btn--ghost" data-value="(">(</button>
    <button class="btn btn--ghost" data-value=")">)</button>

    <button class="btn" data-value="7">7</button>
    <button class="btn" data-value="8">8</button>
    <button class="btn" data-value="9">9</button>
    <button class="btn btn--operator" data-value="÷">÷</button>

    <button class="btn" data-value="4">4</button>
    <button class="btn" data-value="5">5</button>
    <button class="btn" data-value="6">6</button>
    <button class="btn btn--operator" data-value="×">×</button>

    <button class="btn" data-value="1">1</button>
    <button class="btn" data-value="2">2</button>
    <button class="btn" data-value="3">3</button>
    <button class="btn btn--operator" data-value="-">−</button>

    <button class="btn btn--wide" data-value="0">0</button>
    <button class="btn" data-value=".">.</button>
    <button class="btn btn--accent" data-value="=">=</button>
    <button class="btn btn--operator" data-value="+">+</button>
  </div>
</div>

<script>
(()=>{

  /* ============================
       自動套用小 / 中 / 大尺寸
     ============================ */
  function applySize(){
    const w = window.innerWidth;
    if(w < 360) document.body.className = "size-small";
    else if(w < 768) document.body.className = "size-medium";
    else document.body.className = "size-large";
  }
  applySize();
  window.addEventListener("resize", applySize);

  const exprEl = document.getElementById("expression");
  const resEl = document.getElementById("result");
  const pad = document.getElementById("pad");

  let expression = "";
  let locked = null;

  function toEvalStr(s){
    return s.replace(/×/g,'*').replace(/÷/g,'/')
            .replace(/−/g,'-')
            .replace(/(\d+)%/g,'($1/100)');
  }

  function safeEval(expr){
    try{
      const v = Function("return " + toEvalStr(expr))();
      return Number.isFinite(v) ? v : NaN;
    }catch(e){ return NaN; }
  }

  function render(){
    exprEl.textContent = expression || "0";
    const v = safeEval(expression);
    resEl.textContent = isNaN(v) ? "—" : v;
  }

  function push(ch){
    if(locked && /[0-9.(]/.test(ch)){
      expression = "";
      locked = null;
    }
    expression += ch;
    render();
  }

  function doEqual(){
    const v = safeEval(expression);
    if(!isNaN(v)){
      expression = v.toString();
      locked = true;
    }
    render();
  }

  pad.addEventListener("click", e=>{
    const b = e.target.closest("button");
    if(!b) return;

    if(b.dataset.value){
      if(b.dataset.value === "=") return doEqual();
      push(b.dataset.value);
    }

    if(b.dataset.action === "ac"){
      expression = "";
      locked = null;
      render();
    }

    if(b.dataset.action === "back"){
      expression = expression.slice(0,-1);
      render();
    }
  });

  render();

})();
</script>

</body>
</html>